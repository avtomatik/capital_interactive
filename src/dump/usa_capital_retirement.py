from itertools import product

import pandas as pd
from core.combine import combine_capital_combined_archived, combine_local
from core.plot import plot_capital_retirement


def cap_ret():
    kwargs = {
        'filepath_or_buffer': 'archive project CapitalAcquisitionsRetirement.csv',
        'skiprows': range(1, 23)
    }
    # =========================================================================
    # Data Fetch: Run 'projectCapital.py'
    # =========================================================================
    df = pd.read_csv(**kwargs)
    df['period'] = df['period'].astype(int)
    # =========================================================================
    # capital_retirement.yaml
    # =========================================================================
    T = df.iloc[:, 0]
    # =========================================================================
    # Investment
    # =========================================================================
    I = df.iloc[:, 1].mul(df.iloc[:, 3]).div(df.iloc[:, 2])
    # =========================================================================
    # Product
    # =========================================================================
    Y = df.iloc[:, 3]
    YN = df.iloc[:, 2]
    # =========================================================================
    # Max: Product
    # =========================================================================
    # YM = df.iloc[:, 3].div(df.iloc[:, 4]).div(100)
    # Fixed Assets, End-Period, Not Adjusted
    C = df.iloc[:, 6].mul(df.iloc[:, 3]).div(df.iloc[:, 2])
    L = df.iloc[:, 7]
    # =========================================================================
    # C = df.iloc[:, 5].mul(df.iloc[:, 3]).div(df.iloc[:, 2])
    # =========================================================================
    # =========================================================================
    # L = df.iloc[:, 8]
    # =========================================================================
    # =========================================================================
    # Replaced with
    # =========================================================================
    # =========================================================================
    # C = df.iloc[:, 6].mul(df.iloc[:, 3]).div(df.iloc[:, 2])
    # =========================================================================
    # =========================================================================
    # L = df.iloc[:, 7]
    # =========================================================================

    plot_capital_retirement(I, Y, YN, C, L)


'''Project: Capital Retirement'''
# =============================================================================
# capital_retirement.yaml
# =============================================================================


def main(df):
    # df = combine_local().pipe(transform_local)
    _df = df.dropna()
    # =========================================================================
    # Investment
    # =========================================================================
    I = _df.iloc[:, 1].mul(_df.iloc[:, 3]).div(_df.iloc[:, 2])
    # =========================================================================
    # Product
    # =========================================================================
    Y = _df.iloc[:, 3]
    YN = _df.iloc[:, 2]
    # =========================================================================
    # Max: Product
    # =========================================================================
    YM = _df.iloc[:, 3].mul(100).div(_df.iloc[:, 4])
    # =========================================================================
    # Capital, End-Period, Not Adjusted
    # =========================================================================
    C = _df.iloc[:, 6].mul(_df.iloc[:, 3]).div(_df.iloc[:, 2])
    L = _df.iloc[:, 7]
    plot_capital_retirement(I, Y, YN, C, L)
    plot_capital_retirement(I, YM, YN, C, L)


STARTS = {22: 1951, 38: 1967}
STOPS = {83: 2011}
BOUNDS = tuple(product(STARTS, STOPS))

df = combine_capital_combined_archived()

if __name__ == '__main__':
    main(df, 38, 83)
